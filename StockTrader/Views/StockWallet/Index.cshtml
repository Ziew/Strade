@model IEnumerable<StockTrader.Models.CompanyInfoForUserViewModel>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $('#Buy').click(function (e) { //on add input button click
            e.preventDefault();
            var Sn = parseInt($('#StockNumber').val());
            var Cs = $(this).closest("div").attr("id").split(' ')[0];
            var Sv = $("#" + Cs).text();


            var d = $.ajax({
                url: "/StockWallet/Buy",
                type: "POST",
                dataType: "json",
                data: { CompanySymbol: Cs, StockNumber: Sn, StockValue: Sv },
                success: function (data) {
                    $.map(data, function (item) {

                    });

                }
            });

        });
        $('#Sell').click(function (e) { //on add input button click
            e.preventDefault();
            var Sn = parseInt($('#StockNumber').val());
            var Cs = $(this).closest("div").attr("id").split(' ')[0];
            var Sv = $("#" + Cs).text();

            var d = $.ajax({
                url: "/StockWallet/Sell",
                type: "POST",
                dataType: "json",
                data: { CompanySymbol: Cs, StockNumber: Sn, StockValue: Sv },
                success: function (data) {
                    $.map(data, function (item) {

                    });

                }
            });

        });
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var connection = $.hubConnection();
            var hub = connection.createHubProxy("PricingHub");

            connection.start().done(function () {
                hub.invoke("SubscribePriceStream").done(function (_) { console.log("Subscribed to "); })
                    .fail(function (x) { console.log(x); });
            });

            hub.on("OnNewPrice", function (statistics) {
                var d = $('#' + statistics.symbol).text();
                var f = parseFloat(d.replace(",","."));
                var g = parseFloat(statistics.value.replace(",", "."))
                if (f < g) {
                    $('#' + statistics.symbol).html('<span class="fg-green">' + statistics.value  + '</span>');
                } else {
                    $('#' + statistics.symbol).html('<span class="fg-red">' + statistics.value + '</span>');
                }

            });
        });


    </script>
}
@{
    ViewBag.Title = "Index";
}




<div class="metro">

    <div class="container">


        @foreach (var item in Model)
        {
            <div class="span4 panel panel-default text-center tile bg-white" id="@item.CompanySymbol Metro">
                <div class="panel-heading bg-blue">
                    <span class="fg-white lead text-bold">@Html.DisplayFor(modelItem => item.CompanySymbol) </span>
                    <span class="fg-red navbar-right"><i class=" icon-remove"></i> </span>
                </div>
                <p>@Html.DisplayFor(modelItem => item.CompanyName)</p>

                <p>@Html.DisplayFor(modelItem => item.StocksNumber)</p>

                <p><span id="@item.CompanySymbol">@Html.DisplayFor(modelItem => item.CurrentValue)</span></p>
                <a href="#" id="Sell">Sell</a>
                <input id="StockNumber" name="StockNumber" type="text" value="">
                <a href="#" id="Buy">Buy</a>
            </div>

        }

    </div>
    @*<div class="container row ">
            <div class=" bg-darkCobalt tile text-center padding20 ">
                <h2 class="fg-white">@Html.ActionLink("Add Observer", "Create")</h2>
            </div>
        </div>*@
</div>

