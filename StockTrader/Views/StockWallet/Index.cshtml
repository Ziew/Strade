@model IEnumerable<StockTrader.Models.CompanyInfoForUserViewModel>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $('#Buy').click(function (e) { //on add input button click
            e.preventDefault();
            var d = $.ajax({
                url: "/StockWallet/Buy",
                type: "POST",
                dataType: "json",
                data: { CompanySymbol: "", StockNumber: parseInt($('#StockNumber').val()), StockValue: $(this).parent().id() },
                success: function (data) {
                    $.map(data, function (item) {
                       
                    });
                
                }
            });

        });
        $('#Sell').click(function (e) { //on add input button click
            e.preventDefault();
            var d = $.ajax({
                url: "/StockWallet/Sell",
                type: "POST",
                dataType: "json",
                data: { term: "", decisionTaskClassId: 3 },
                success: function (data) {
                    var f = "";
                    $.map(data, function (item) {
                        f += '<option value="' + item.Value + '">' + item.Text + '</option>';
                    });
                    $('#Input-List').append('<select id="InputsId" name ="InputsId">' + f + '</select><button class="btn-xs btn-danger tooltip-enable remove_field" rel="tooltip" title="Usuń wejście"><i class="fa fa-trash"></i></button>');

                }
            });

        });
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var connection = $.hubConnection();
            var hub = connection.createHubProxy("PricingHub");

            connection.start().done(function () {
                hub.invoke("SubscribePriceStream").done(function (_) { console.log("Subscribed to "); })
                    .fail(function (x) { console.log(x); });
            });

            hub.on("OnNewPrice", function (statistics) {

                $('#' + statistics.symbol).html(statistics.value);

            });
        });


    </script>
}
@{
    ViewBag.Title = "Index";
}




<div class="metro">

    <div class="container">


        @foreach (var item in Model)
        {
            <div class="span4 bg-grayDark  text-center tile " id ="Metro" @item.CompanySymbol>
                <p>
                    <span class="fg-steel lead text-bold">@Html.DisplayFor(modelItem => item.CompanySymbol) </span>
                    <span class="fg-white navbar-right"><i class=" icon-remove"></i> </span>
                </p>
                <p class="fg-white">@Html.DisplayFor(modelItem => item.CompanyName)</p>

                <p class="fg-white">@Html.DisplayFor(modelItem => item.StocksNumber)</p>

                <p class="fg-white"><span id=@item.CompanySymbol>@Html.DisplayFor(modelItem => item.CurrentValue)</span></p>
                <a href="#" id="Sell">Sell</a>
                <input   id="StockNumber" name="StockNumber" type="text" value="">
                <a href="#" id="Buy">Buy</a>
            </div>

        }

    </div>
    <div class="container row ">
        <div class=" bg-darkCobalt tile text-center padding20 ">
            <h2 class="fg-white">@Html.ActionLink("Add Observer", "Create")</h2>
        </div>
    </div>
</div>

